---
title: "Ant colony"
author: "Jan Lennartz & Andrei Chirita"
date: "11/22/2020"
output: pdf_document
---
```{r,echo=FALSE,results='hide'}
library(curl)
library(igraph)
source("helpers.R")
```
\newpage
\tableofcontents
\newpage

# Introduction

Ant colonies have a complex and fascinating social structure that may bring answers to a multitude of scientific questions. Usually the nest are organized in a stratified manner with a queen at the center and numerous workers doing tasks needed for the upkeep of the colony. The study for which the data we worked on was collected sought to understand the social structure of *Camponotus fellah* ants, what are the groups inside the colonies and what factors define them. 

## The data

The original data of the study consist of more than 9 million observed interactions between ants collected for 41 days from ants belonging to 6 colonies. For our project we decided to work on ..... 

### Preliminary data exploration

In the following section we will show how the data is structured for a single colony in a single day (namely day 17, colony 1). We will start by loading the data using the get_graph function that we built previously.

```{r}
g <- get_graph(colony = 1, day = 17)
```
Next we will have a look at the vertices of the graph, as can be seen there are 99 of them in this graph.

```{r}
V(g)
```
Next we displayed the number of edges, as can be seen there are over 3300 edges. Thus in day 17, for the first colony there were over 3342 interactions between 99 ants.
```{r}
ecount(g)
```
```{r}
str(vertex.attributes(g))
```
Each vertex has also a set of attributes like:

* Several attributes that are useful for understanding the interactions of the studied

* Attributes that register the visits of the ant to important places of the colony (like the brood or the nest entrance)

* The groups fitted by the authors of the study

* The age of the ant (measured in days)

* The body size of the ant

```{r,echo=FALSE}
foragers <- induced_subgraph(g, which(V(g)$group=="F"))
nurses <- induced_subgraph(g, which(V(g)$group=="N"))
cleaners <- induced_subgraph(g, which(V(g)$group=="C"))

groups <- list(Foragers=foragers, Nurses=nurses, Cleaners=cleaners)

par(mfrow=c(1,3))

lapply(seq_along(groups), function(u){plot(groups[[u]],main = paste(names(groups)[u]),vertex.label=NA)})
```

As we can see the foragers and cleaners groups contain more ants than the nurses group and they also contains more interactions.
## The original paper

The original paper was written by: Danielle P. Mersch, Alessandro Crespi and Laurent Keller and explores questions related how can we separate ant colonies into groups and what makes ants change the group they belong to. During their study they found 3 main groups based on the interactions between ants and concluded that age is the main factor that determines ants to change the group they are part of. All colonies studied had 4-years old queens and between 122 and 192 workers per colony. Each ant was marked and followed individually and an interaction between two ants were defined by the fact that "the front end of one ant was located within thetrapezoidal shape representing the other ant".

## Our questions

The goal of this work is to conduct the given data set w.r.t. various aspects. Furthermore, a validation of the key results of the original paper is carried out. For this a sample colony is chosen on a given day. On this network the analysis is to be done. Certain properties will be evaluated over multiple days when required.

We will first explore the network in a descriptive manner. This includes characteristics like degree distribution, density, diameter and more. In the second step we have a closer look at the groups. First, we validate that the three groups are a valid proposal for the given network. This is done by running a clustering algorithm on the network to identify the groups which will be compared to the labeled groupings. Second, we investigate how frequently ants communicate within groups and compare this to the level of communication between groups. We answer the question how fast information can be spread in the network and compare this to the result of the paper. Additionally, we calculate the centrality of specific ant or groups (e.g. the queen) w.r.t. different measures. Furthermore, we review several properties of the ants and their correlation with the groups (e.g. age, size).

#  Descriptive Statistics of the network

## By group

Before looking at the following summary statistics per group it is important to know about the size of each group. There are 50 ants in the group foragers, 27 cleaners and 18 are nurses. This means the following results need to be considered under the fact of this inequal distribution of group members.

### Histogram and Density

The foragers have a rather wider spread of degrees compared to the other two groups. Most of them have a degree greater than 40. The other two groups are distributed very homogeneously. It is notable though that there is a hierarchy of degrees starting from the low degree group of nurses to the midrange group of cleaners over to the higher degree group of foragers.

```{r echo=FALSE}
lapply(names(groups), function(u) hist(degree(groups[[u]]), freq = FALSE, 
                                       main = paste("Histogram of", u), xlab = "Degree"))
```

```{r}
lapply(groups, function(u) plot(degree_distribution(u), xlab = "Degree", ylab = "Density"))
```


### Connectivity and Components

All separate groups are connected and thus, each of them form a big component.
```{r}
lapply(groups, is_connected)
```


### Average Path Length and Diameter

The average path length can be an indicator of how connected a network is. Here the foragers and the cleaners have a similar average path length of around 1.12. In comparison the nurses have an average path length of 1.09, a bit smaller. All three groups are very well connected because most ants can reach any other ant of the same group in less than 2 steps. The diameter is the longest shortest path in a network and differs quite a bit in this network. The foragers have a diameter of 11, compared to the nurses with 7 and the cleaners with 4. This might be an indicator of a lower connection level in the group of the foragers. There exists at least one ant who has to go over 11 other ants in order to connect with another specially chosen ant. This is quite extreme considering the average path length is 1.12 in this group.
```{r}
lapply(groups, average.path.length)
lapply(groups, diameter)
```
### Centrality Measures

Degree centrality is very homogeneous. This is due to the equal distribution of degrees. It is not very informative for us.

```{r}
deg <- lapply(groups, centralization.degree)
deg <- lapply(deg, function(u) u$res[order(u$res, decreasing = TRUE)])
lapply(names(deg), function(u) barplot(deg[[u]], main = paste("Degree centrality", u)))
```



Closeness centrality: Similar picture. Most of the ants are close to many other nodes due to the high connectivity.

```{r}
clos <- lapply(groups, centralization.closeness)
clos <- lapply(clos, function(u) u$res[order(u$res, decreasing = TRUE)])
lapply(names(clos), function(u) barplot(clos[[u]], main = paste("Closeness centrality", u)))
```

Betweenness centrality: Here we see actually a decreasing structure in all three groups. Some ants lie on the paths connecting other ants. 

```{r}
betw <- lapply(groups, centralization.betweenness)
betw <- lapply(betw, function(u) u$res[order(u$res, decreasing = TRUE)])
lapply(names(betw), function(u) barplot(betw[[u]], main = paste("Betweenness centrality", u)))
```

Eigenvalue centrality: Here we see actually a decreasing structure in all three groups. Some ants lie on the paths connecting other ants. 

```{r}
eig <- lapply(groups, centralization.evcent)
eig <- lapply(eig, function(u) u$vector[order(u$vector, decreasing = TRUE)])
lapply(names(eig), function(u) barplot(eig[[u]], main = paste("Eigenvalue centrality", u)))
```

Pagerank: Here we can see that the foragers have a few ants who are very important w.r.t to this centrality measure. This could indicate that these ants are consulted by many other ants who themselves are consulted by many ants. 
```{r}
pagr <- lapply(groups, page.rank)
pagr <- lapply(pagr, function(u) u$vector[order(u$vector, decreasing = TRUE)])
lapply(names(pagr), function(u) barplot(pagr[[u]], main = paste("Pagerank", u)))
```

### Clustering Coefficient
Very similar results again for the clustering coefficient. All groups are very highly connected.
```{r}
lapply(groups, transitivity)
```